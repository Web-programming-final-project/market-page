<?php
$connection = mysqli_connect('localhost','root','','real_estate');
if(isset($_GET['submit'])){
    if(!empty($_GET['property_type'])){
        $select=$_GET['property_type'];
        // ensure that $select is valid and not SQL injection
        $sql="SELECT Building_Type, Description, Bed_Room, Garage, Address, Postal_code, Price From property where Building_Type = '$select'";
        $result=mysqli_query($connection,$sql);
        
    }
    if(!empty($_GET['cites'])){
        $select=$_GET['cites'];
        switch($select){
            case 1:
                $select= "Oshawa";
                break;
            case 2:
                $select= "Ajax";
                break;
            case 3:
                $select="Whitby";
                break;
            case 4:
                $select="Toronto";
                break;
            case 5:
                $select="Vancouver";
                break;
            case 6:
                $select="Quebec";
                break;
            case 7:
                $select="Ottawa";
                break;
            default:
            echo "{$select} is not available";
        
        }
        echo "{$select}";
        // ensure that $select is valid and not SQL injection
        $sql="SELECT * From property where city = '$select'";
        $result=mysqli_query($connection,$sql);
       
    }
    if(!empty($_GET['provinces'])){
        $select=$_GET['provinces'];
        switch($select){
            case 1:
                $select= "Ontario";
                break;
            case 2:
                $select= "British Columbia";
                break;
            case 3:
                $select="Quebec";
                break;
            case 4:
                $select="New Brunswick";
                break;
            case 5:
                $select="Nova Scotia";
                break;
            case 6:
                $select="Manitoba";
                break;
            case 7:
                $select="Alberta";
                break;
            default:
            echo "{$select} is not available";
        
        }
        echo "{$select}";
        // ensure that $select is valid and not SQL injection
        $sql="SELECT * From property where Province = '$select'";
        $result=mysqli_query($connection,$sql);
        if($result==null){
            echo $select." Not available yet!! Thank you for your interest!";
        }
    }
    
    if(!empty($_GET['property_type'])){
        $select=$_GET['property_type'];
        // ensure that $select is valid and not SQL injection
        $sql="SELECT * From property where Building_Type = '$select'";
        $result=mysqli_query($connection,$sql);
        
    }

    $search="";
    if(isset($_GET['search'])){
        $search=$_GET['search'];
        $sql="SELECT * from property where address like '%$search%'";
        $result= mysqli_query($connection,$sql);
    }
}
?>
<!DOCTYPE html>
<html>
    <head>
        <title>
            Market's Page
        </title>
    </head>

    <body>
        <div id="header">
            <div class="logo">Logo here</div> <!--make this into a "link to get back to home Page"-->
        </div>


        <!--menu bar to search--> 
        <div id="menu">
            
        </div>

        <div id="search-box">
            <form action="" method="GET">
            <table>
                <tbody>

                    <tr> <!--Location search bar-->
                        <td>Location</td>
                        <td colspan="3">
                            <input type="text" name="search" placeholder="Type in the address you want " value="<?php echo $search ?>">
                           

                            <!-- Make css for this part to appear when clicked into to search box-->
                            <!--<div class="suggestion">Suggestion</div>
                            <ul>
                                <li>
                                    <span>
                                        Type in Street/Neighborhood, Reigon/City, Province
                                    </span>
                                </li>
                                <li>If dont type in location here, You can choose Reigons from the drop boxes bellow</li>
                            </ul>-->
                        </td>
                    </tr>

                    <tr>
                        <td>Demand</td>
                        <td>
                            <select name="demand">
                                <option value="sale">Buy houses</option>
                                <option value="rent">Rent houses</option>
                            </select>
                        </td>


                        <td>Property type</td>
                        <td>
                            <select name="property_type">
                                <option value="Home">---- Choose type of property ----</option>
                                <option value="House">Houses</option>
                                <option value="Apartment">Appartment</option>
                                <option value="Duplex">duplex</option>
                                
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td>Cities</td>
                        <td>
                           <select name="cites">
                                <option value="0">-----All Cities-----</option>
                                <option value="1">Oshawa</option>
                                <option value="2">Ajax</option>
                                <option value="3">Whitby</option>                                
                                <option value="4">Toronto</option>              
                                <option value="5">Vancouver</option>                                
                                <option value="6">Quebec</option>                                
                                <option value="7">Ottawa</option>
                           </select>
                        </td>

                        <td>Province</td>
                        <td>
                            <select name="provinces" >
                                <option value="0">-----All Provinces-----</option>
                                <option value="1">Ontario</option>
                                <option value="2">British Columbia</option>
                                <option value="3">Quebec</option>
                                <option value="4">New Brunswick</option>
                                <option value="5">Nova Scotia</option>
                                <option value="6">Manitoba</option>
                                <option value="7">Alberta</option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td colspan="4" align="center">
                            <input type="submit" name="submit">
                        </td>
                    </tr>
                </tbody>
            </table>
            </form>
        </div>
        <div>
            <?php foreach ($result as $output){ ?>
            Building Type: <?php echo $output['Building_Type']."<br>"; ?>
            Land size: <?php echo $output['Land_Size']."<br>"; ?>
            Bed Room: <?php echo $output['Bed_Room']."<br>"; ?>
            Description: <?php echo $output['Description']."<br>"; ?> 
            Address: <?php echo $output['address']."<br>";?>
            Postal code:<?php echo $output['Postal_code']."<br>";?>
            Price: <?php echo $output['Price']."<br>"?>
            <br><br>
            <?php    } ?>
        </div>
    </body>
</html>
